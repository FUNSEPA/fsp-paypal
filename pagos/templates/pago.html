{% extends "base.html" %}

{% load staticfiles %}


{% block extra_css %}
    <style>
	#contact {
		background-image: url("{% static "images/fondo.jpg" %}");
		background-position: center center;
		background-repeat: no-repeat;
		background-size: inherit;
		display: block;
		float: left;
		padding: 70px 0;
		width: 100%;
	}
</style>
{% endblock extra_css %}
{% block content %}
<!-- Start Contact section -->
<section id="contact">
	<div class="container-fluid">
		<div class="row">
			
			<div class="col-md-4 col-sm-4 col-xs-12">
				
				<div class="well">
					<h2>Make a donation</h2>
					<form action="{{action}}" method="post" class="contact-form" id="formulario">
						{{form.non_field_errors}}
						{% csrf_token %}
						{% for field in form %}
						<div class="form-group" id="form-group-{{field.name}}">
							{{ field }}
						</div>
						{% endfor %}
						<div id="captcha-space"></div>
						<button id="btn-submit" type="submit" data-text="YEAH!" class="btn btn-primary btn-raised">DONATE</button>
					</form>
				</div>
			</div>
			<div class="col-md-4 col-sm-6 col-xs-12">
			</div>
		</div>
	</div>
</section>
<!-- End Contact section -->


{% endblock content %}

{% block extra_js %}
<script src="{% static "js/jquery.card.js" %}"></script>
<script src='https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit'></script>
<script src="{% static "vendor/js/jquery.creditCardValidator.js" %}"></script>
<script>
	var form_valid = false;
	$('#form-group-card_type').append('<span id="card-label"></span>');
	$(document).ready(function () {
		$('#btn-submit').prop('disabled', true);

		$('#formulario').on('submit', function (e) {
			$('#btn-submit').prop('disabled', true);

			$('#id_total').val(parseFloat($('#id_total').val()).toFixed(2));

			if(form_valid==false){
				e.preventDefault();
				alert("Captcha error")
				$('#btn-submit').prop('disabled', false);
			}
		});

		$('#id_number').validateCreditCard(function(result){
			if(result.valid){
				$.ajax({
					url: {% url "card_consult" %} + result.card_type.name,
					dataType: 'json',
					success: function (response) {
						$('#id_card_type').val(response.id);
						$('#card-label').show().html(response.name);
					}
				})
			}
			else{
				$('#id_card_type').val('')
				$('#card-label').html('').hide();
			}
		});
	});
	var onloadCallback = function() {
		grecaptcha.render('captcha-space', {
			'sitekey' : '6LexSAkUAAAAAIYsk4MMEFL_wWJtw-TADuwMxMC1',
			'callback': function () {
				$('#btn-submit').prop('disabled', false);
				form_valid = true;
			}
		});
	};
</script>
{% endblock extra_js %}